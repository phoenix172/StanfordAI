@page "/data"
@using AnomalyDetection.Client.ServiceContracts
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@inject IAnomalyDetector Detector
@using AnomalyDetection.Client.Components
@using Plotly.Blazor
@using Plotly.Blazor.Traces
@using Plotly.Blazor.Traces.ScatterLib
@using System.Reflection
@using System.Collections.Immutable
@using Plotly.Blazor.LayoutLib

<MyMudProviders />

<PageTitle>Weather</PageTitle>



@if (_data != null)
{
    <PlotlyChart @bind-Config="_config" @bind-Layout="_layout" @bind-Data="_data" @ref="_chart"/>
}



@code {
    [CascadingParameter]
    public MudTheme Theme { get; set; }
    
    PlotlyChart _chart;
    Config _config;
    Layout _layout;
    
    // Using of the interface IList is important for the event callback!
    IList<ITrace>? _data;

    protected override async Task OnInitializedAsync()
    {
        _config = new ()
        {
            FillFrame = true,
            Responsive = true
        };
        
        _layout = new Layout
        {
            Title = new Title
            {
                Text = GetType().Name
            },
            // PaperBgColor = Theme.PaletteDark.Surface.ToString(),
            // PlotBgColor = Theme.PaletteDark.Surface.ToString(),
            Font = new Font
            {
                // Color = Theme.PaletteDark.TextPrimary.ToString()
            },
            HoverMode = HoverModeEnum.XUnified
        };
        
        await Detector.LoadFrom("Data/Part1");
        var columns = Detector.TrainingData.EnumerateColumns().ToImmutableArray();
        IList<object> xColumn = columns[0].Cast<object>().ToList();
        IList<object> yColumn = columns[1].Cast<object>().ToList();

        _data = new List<ITrace>
        {
            new Scatter
            {
                Name = "Scatter",
                Mode = ModeFlag.Markers,
                X = xColumn,
                Y = yColumn,
                HoverInfo = HoverInfoFlag.X|HoverInfoFlag.Y,
                HoverOn = HoverOnFlag.Points
            }
        };
    }
}
